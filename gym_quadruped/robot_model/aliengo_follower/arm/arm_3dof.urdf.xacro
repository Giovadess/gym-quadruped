<?xml version="1.0"?>

<robot name="arm" xmlns:xacro="http://ros.org/wiki/xacro">

	<!-- Things that are needed only for Gazebo (not the physical robot). These include sensor and controller plugin specifications -->
	<xacro:include filename="$(find aliengo_description)/urdfs/arm/arm_3dof.transmission.xacro"/>
  
  <!-- Propagate last link name information because it is the gripper's parent link -->
  <!-- <xacro:property name="last_arm_link" value="end_effector_link"/> -->

  <xacro:macro name="passive_arm_3dof" params="load_arm_transmissions sim_gazebo *origin">


	<joint name="base_to_arm" type="fixed">
    		<parent link="trunk"/>
    		<child link="pa_base_ext"/>
        <xacro:insert_block name="origin" />
	</joint>

  <link name="pa_base_ext">
      <inertial>
        <origin xyz="0.0 0.0 0.0" rpy="0 0 0" />
        <mass value="0.220" />
        <inertia ixx="0.004622" ixy="9E-06" ixz="6E-05" iyy="0.004495" iyz="9E-06" izz="0.002079" />
      </inertial>
      <visual>
        <origin xyz="0 0 0" rpy="0 0 0" />
        <geometry>
          <mesh filename="package://aliengo_description/meshes/arm/passive_arm_base_link.dae" />
        </geometry>
        <material name="">
          <color rgba="0.75294 0.75294 0.75294 1" />
        </material>
      </visual>
      <collision>
        <origin xyz="0 0 0" rpy="0 0 0" />
        <geometry>
          <mesh filename="package://aliengo_description/meshes/arm/passive_arm_base_link.dae" />
        </geometry>
      </collision>
  </link>

   <link name="pa_link_0_ext">
    <inertial>
      <origin rpy="0 0 0" xyz="0.0248 0.0 0.0169"/>
      <mass value="0.554" />
      <inertia ixx="0.00457" ixy="1E-06" ixz="2E-06" iyy="0.004831" iyz="0.000448" izz="0.001409" />
    </inertial>
    <visual>
      <origin rpy="0.0 0.0 0.0" xyz="0.0 0.0 0.0"/>
      <geometry>
        <mesh filename="package://aliengo_description/meshes/arm/passive_arm_link_1.dae"/>
      </geometry>
      <material name="">
        <color rgba="0.75294 0.75294 0.75294 1"/>
      </material>
    </visual>
    <collision>
      <origin rpy="0.0 0.0 0.0" xyz="0.0 0.0 0.0"/>
      <geometry>
        <mesh filename="package://aliengo_description/meshes/arm/passive_arm_link_1.dae"/>
      </geometry>
    </collision>
  </link>

  <joint
    name="pa_joint_0_ext"
    type="revolute">
    <origin rpy="0.0 0.0 0.0" xyz="0.1183 0.0 0.074"/>
    <parent
      link="pa_base_ext" />
    <child
      link="pa_link_0_ext" />
    <axis
      xyz="0 0 1" />
    <limit lower="-1" upper="1" effort="100" velocity="10" />
    <dynamics damping="0.1" friction="0" />
    <safety_controller k_position="10" k_velocity="1" soft_lower_limit="-1" soft_upper_limit="1" />
  </joint>

  
  <link name="pa_link_1_ext">
    <inertial>
      <origin rpy="0 0 0" xyz="0.0909 0.0 0.0923"/>
      <mass value="0.554" />
      <inertia ixx="0.00457" ixy="1E-06" ixz="2E-06" iyy="0.004831" iyz="0.000448" izz="0.001409" />
    </inertial>
    <visual>
      <origin rpy="0.0 0.0 0.0" xyz="0.0 0.0 0.0"/>
      <geometry>
        <mesh filename="package://aliengo_description/meshes/arm/passive_arm_link_2.dae"/>
      </geometry>
      <material name="">
        <color rgba="0.75294 0.75294 0.75294 1"/>
      </material>
    </visual>
    <collision>
      <origin rpy="0.0 0.0 0.0" xyz="0.0 0.0 0.0"/>
      <geometry>
        <mesh filename="package://aliengo_description/meshes/arm/passive_arm_link_2.dae"/>
      </geometry>
    </collision>
  </link>

  <joint
    name="pa_joint_1_ext"
    type="revolute">
    <origin rpy="0.0 0.0 0.0" xyz="0.0498 0 0.034"/>
    <parent
      link="pa_link_0_ext" />
    <child
      link="pa_link_1_ext" />
    <axis
      xyz="0 1 0" />
    <limit lower="0" upper="1" effort="100" velocity="10" />
    <dynamics damping="0.1" friction="0" />
    <safety_controller k_position="10" k_velocity="1" soft_lower_limit="-1" soft_upper_limit="1" />
  </joint>

  <link name="pa_link_2_ext">
    <inertial>
      <origin rpy="0 0 0" xyz="0.0194 0.0 -0.125"/>
      <mass value="0.258" />
      <inertia ixx="0.011088" ixy="5E-06" ixz="0" iyy="0.001072" iyz="-0.000691" izz="0.011255" />
    </inertial>
    <visual>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <mesh filename="package://aliengo_description/meshes/arm/passive_arm_link_3.dae"/>
      </geometry>
      <material name="">
        <color rgba="0.75294 0.75294 0.75294 1"/>
      </material>
    </visual>
    <collision>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <mesh filename="package://aliengo_description/meshes/arm/passive_arm_link_3.dae"/>
      </geometry>
    </collision>
  </link>

  <joint
    name="pa_joint_2_ext" type="revolute">
    <origin rpy="0.0 0.0 0.0" xyz="0.1817 0.0 0.1845"/>
    <parent
      link="pa_link_1_ext" />
    <child
      link="pa_link_2_ext" />
    <axis
      xyz="0 1 0" />
    <limit lower="-3.0" upper="1.0" effort="100" velocity="10" />
    <dynamics damping="0.1" friction="0" />
    <safety_controller k_position="10" k_velocity="1" soft_lower_limit="-0.5" soft_upper_limit="1" />
  </joint>

  <link name="arm_ee">
    <visual>
      <origin xyz="0.0 0.0 0.0" rpy="0.0 0.0 0.0"/>
      <geometry>
        <sphere radius="0.001"/>
      </geometry>
      <material name="black" />
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <sphere radius="0.001"/>
      </geometry>
    </collision>
  </link>
  
  <joint name="joint2_arm" type="fixed">
    <origin rpy="0.0 0.0 0.0" xyz="0.0388 0.0 -0.25"/>
    <parent link="pa_link_2_ext"/>
    <child link="arm_ee"/>
    <axis xyz="0 1 0"/>
  </joint>

  <gazebo reference="pa_joint_0_ext">
      <implicitSpringDamper>true</implicitSpringDamper>
      <springStiffness>10</springStiffness>
      <springReference>0.0</springReference>
  </gazebo>

  <gazebo reference="pa_joint_1_ext">
      <implicitSpringDamper>true</implicitSpringDamper>
      <springStiffness>10</springStiffness>
      <springReference>0.0</springReference>
  </gazebo>

  <gazebo reference="pa_joint_2_ext">
      <implicitSpringDamper>true</implicitSpringDamper>
      <springStiffness>10</springStiffness>
      <springReference>0.0</springReference>
  </gazebo>

    
<!-- The ft_sensor plugin -->  
<!--
  <xacro:if value="${sim_gazebo}">
    <gazebo>
        <plugin name="ft_sensor" filename="libgazebo_ros_ft_sensor.so">
            <updateRate>1000.0</updateRate>
            <topicName>ft_sensor_ee</topicName>
            <jointName>z_joint_7</jointName>
        </plugin>
    </gazebo>
  </xacro:if>
  -->

  <xacro:if value="${load_arm_transmissions}">
		<xacro:load_gazebo_arm_transmissions/>
  </xacro:if>

	</xacro:macro>
</robot>
